{% extends 'base.html' %}
{% block title %}Dashboard - Ventas{% endblock %}
{% block navbar_title %}Gestor de Ventas{% endblock %}

{% block content %}
<div class="row g-4">
    <!-- Registrar nueva venta -->
    <div class="col-lg-4">
        <div class="card card-minimal p-4">
            <h2 class="section-title">Registrar nueva venta</h2>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label text-white">Descripción</label>
                    <input type="text" class="form-control" name="descripcion" placeholder="Descripción" required>
                </div>
                <div class="mb-3">
                    <label class="form-label text-white">Cliente</label>
                    <input type="text" class="form-control" name="cliente" placeholder="Cliente" required>
                </div>
                <div class="mb-3">
                    <label class="form-label text-white">DNI</label>
                    <input type="number" class="form-control" name="dni" placeholder="DNI">
                </div>
                <!-- Monto -->
                <div class="mb-3 position-relative">
                    <label class="form-label text-white">Monto</label>
                    <input type="number" step="0.01" class="form-control pe-step" name="monto" placeholder="Monto"
                        required>
                    <div class="step-buttons">
                        <button type="button" onclick="step(this,1)">▲</button>
                        <button type="button" onclick="step(this,-1)">▼</button>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label text-white">Fecha</label>
                    <input type="date" class="form-control" name="fecha" required>
                </div>
                <button type="submit" name="registrar" class="btn btn-primary w-100">Registrar venta</button>
            </form>
        </div>
    </div>

    <!-- Filtrar ventas -->
    <div class="col-lg-4">
        <div class="card card-minimal p-4">
            <h2 class="section-title">Filtrar ventas</h2>
            <form method="GET" class="row gx-3 align-items-end">
                <!-- Año -->
                <div class="col-md-4 position-relative">
                    <label class="form-label text-white">Año</label>
                    <input type="number" class="form-control pe-step" name="anio" placeholder="Año"
                        value="{{ anio or '' }}">
                    <div class="step-buttons">
                        <button type="button" onclick="step(this,1)">▲</button>
                        <button type="button" onclick="step(this,-1)">▼</button>
                    </div>
                </div>
              <!-- Mes con indicador triangular -->
      <div class="col-md-4 position-relative month-indicator">
        <label class="form-label text-white">Mes</label>
        <select class="form-control" name="mes">
          <option value="">Mes</option>
          {% for i,m in [(1,'Enero'),(2,'Febrero'),(3,'Marzo'),(4,'Abril'),
                        (5,'Mayo'),(6,'Junio'),(7,'Julio'),(8,'Agosto'),
                        (9,'Septiembre'),(10,'Octubre'),(11,'Noviembre'),(12,'Diciembre')] %}
          <option value="{{ i }}" {% if mes==i %}selected{% endif %}>{{ m }}</option>
          {% endfor %}
        </select>
      </div>
                <!-- Botón Filtrar alineado -->
                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-filter w-100"
                        style="height:calc(2.5rem + 2px);">Filtrar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ventas registradas -->
    <div class="col-lg-4">
        <div class="card card-minimal p-4">
            <h2 class="section-title">Ventas registradas</h2>
            {% if ventas %}
            <ul class="list-group list-group-flush">
                {% for v in ventas %}
                <li class="list-group-item bg-transparent border-0 px-0 py-2 text-white">
                    {{ v[5] }} – {{ v[2] }}: S/ {{ v[4] }}
                </li>
                {% endfor %}
            </ul>
            <p class="mt-3 fw-semibold text-white">Total: S/ {{ total }}</p>
            {% else %}
            <p class="text-white">No hay ventas registradas para este filtro.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}