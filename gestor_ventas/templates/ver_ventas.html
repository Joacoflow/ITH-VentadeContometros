{% extends 'base.html' %}
{% block navbar_title %}Reporte de Ventas{% endblock %}
{% block title %}Reporte de Ventas{% endblock %}
{% block content %}

<h2 class="section-title">Consultar ventas por cliente</h2>
<div class="card card-minimal mb-4 p-4">
  <h3 class="mb-3">Buscar cliente</h3>
  <form method="GET" class="row gx-3 align-items-end">
    <div class="col-md-4">
      <label class="form-label text-white">DNI o Nombre</label>
      <input type="text" class="form-control" name="busqueda" value="{{busqueda or ''}}" placeholder="DNI o Nombre">
    </div>
    <div class="col-md-3">
      <label class="form-label text-white">Año</label>
      <input type="number" class="form-control" name="anio" value="{{anio or ''}}" placeholder="Año">
    </div>
    <div class="col-md-3">
      <label class="form-label text-white">Mes</label>
      <select class="form-control" name="mes">
        <option value="">Mes</option>
        {% for i,m in [(1,'Enero'),(2,'Febrero'),(3,'Marzo'),(4,'Abril'),
                      (5,'Mayo'),(6,'Junio'),(7,'Julio'),(8,'Agosto'),
                      (9,'Septiembre'),(10,'Octubre'),(11,'Noviembre'),(12,'Diciembre')] %}
        <option value="{{i}}" {% if mes==i %}selected{% endif %}>{{m}}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-filter w-100">Buscar</button>
    </div>
  </form>
</div>
<div class="card card-minimal p-4">
  <h3 class="mb-3">Resultados de la búsqueda</h3>
  {% if ventas %}
    <h5>Cliente: {{cliente_nombre}} (DNI: {{cliente_dni}})</h5>
    <div class="table-responsive">
      <table class="table table-striped mb-0">
        <thead><tr><th>ID</th><th>Descripción</th><th>Monto</th><th>Fecha</th></tr></thead>
        <tbody>
          {% for v in ventas %}
          <tr>
            <td>{{v[0]}}</td><td>{{v[1]}}</td><td>S/ {{v[2]}}</td><td>{{v[3]}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <p class="mt-3"><strong>Total de compras:</strong> S/ {{total}}</p>
  {% else %}
    <p>No se encontraron ventas para este cliente o filtro.</p>
  {% endif %}
</div>
{% endblock %}
